<template>
  <div class="container mt-5 border-bottom border-dark item" @click="goTo()">
    <div class="row">
      <div class="col d-flex justify-content-start align-middle">
        <h2 class="">{{ threadObj.title }}</h2>
      </div>

      <div class="col align-middle">
        <div v-if="threadObj.threadOwner" class="item-font">
          {{ threadObj.threadOwner.username }}
        </div>
      </div>

      <div class="col d-flex justify-content-end ">
        <h6 class="">{{ getDate }}</h6>
      </div>

      <div
        class="col d-flex justify-content-end "
        v-if="user ? user.roles.includes('ADMIN') : false"
      >
        <!-- <button type="button" class="btn btn-dark" @click.stop="deleteThread()">Ta bort</button>
        <button type="button" class="btn btn-dark" @click.stop="lockThread()">l√•s</button> -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="30"
          height="30"
          fill="currentColor"
          class="bi bi-trash trash align-text-center"
          viewBox="0 0 16 16"
          @click.stop="deleteThread()"
          
        >
          <path
            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"
          />
          <path
            fill-rule="evenodd"
            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"
          />
        </svg>

        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="30"
          height="30"
          fill="currentColor"
          :class="{isLocked: threadObj.locked, isOpen: !threadObj.locked}"
          class="bi bi-file-lock2"
          viewBox="0 0 16 16"
          @click.stop="lockThread()"
        >
          <path
            d="M8 5a1 1 0 0 1 1 1v1H7V6a1 1 0 0 1 1-1zm2 2.076V6a2 2 0 1 0-4 0v1.076c-.54.166-1 .597-1 1.224v2.4c0 .816.781 1.3 1.5 1.3h3c.719 0 1.5-.484 1.5-1.3V8.3c0-.627-.46-1.058-1-1.224z"
          />
          <path
            d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"
          />
        </svg>
      </div>
    </div>
  </div>
</template>
<script>
export default {
  props: {
    threadObj: Object,
    forum_id: Number,
  },
  computed: {
    getDate() {
      return new Date(this.threadObj.timestamp).toLocaleString("sv-SE");
    },
    user() {
      return this.$store.state.loggedInUser;
    },
    thread(){
      return this.threadObj
    }
  },
  methods: {
    goTo() {
      this.$store.commit("setThread", this.threadObj);
      this.$router.push({
        path: `${this.forum_id}/thread/${this.threadObj.thread_id}`,
      });
    },
    async deleteThread() {
      const response = await fetch(
        `/api/v1/forums/threads/${this.threadObj.thread_id}`,
        {
          method: "DELETE",
        }
      );
      if (response.status === 204) {
        this.$store.dispatch("fetchForum", this.forum_id);
      }
    },
    async lockThread() {
      console.log("THread Obj", this.threadObj);
      console.log(
        "LOCKED",
        this.threadObj.locked + " - !LOCKED",
        !this.threadObj.locked
      );
      let thread = {
        title: this.threadObj.title,
        forum_id: this.threadObj.forum_id,
        timestamp: this.threadObj.timestamp,
        threadOwner: this.threadObj.threadOwner,
        locked: !this.threadObj.locked,
        messages: this.threadObj.messages,
        user: this.threadObj.user,
      };
      let response = await fetch(
        `/api/v1/forums/threads/${this.threadObj.thread_id}`,
        {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(thread),
        }
      );
      if (response.status === 204) {
        console.log("dispatch")
        this.$store.dispatch("fetchForum", this.forum_id);
      }


    },
  },
  // created(){
  //   console.log(this.threadObj, "THREADOBJ")
  // }
};
</script>
<style scoped>
.item-font {
  font-size: 1rem;
  font-style: oblique;
}
.item:hover {
  cursor: pointer;
}
.isLocked{
  color: red;
}
.isOpen{
color:green
}
svg {
  width: 4rem;
}
svg:hover {
  width: 4rem;
  cursor: pointer;
  color: red;
}
svg.isLocked:hover {
  width: 4rem;
  cursor: pointer;
  color:green
}
</style>
